<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>ERP - SAE4</title>
    <!-- SI LE SERVEUR EST DOWN, IL FAUT PASSER CETTE VARIABLE A FALSE POUR QUE LES URL SOIENT LOCALHOST (il faut host le serveur de la partie server avec java) -->
    <script src="../js/isLocalHost.js"></script>
    <!-- fontawesome -->
    <script src="https://kit.fontawesome.com/d911925501.js" crossorigin="anonymous"></script>
    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <!-- nous -->
    <link rel="stylesheet" href="../css/base.css" />
    <script src="../js/filteredZone.js"></script>
    <script src="../js/Modals.js"></script>
    <script>
        /* generate with spring using session credentials ?*/
        const isGerant = true;
        const USERID = 1;
    </script>
</head>

<body class="bgIsBlackPage container-fluid text-center p-4">
    <div class="col-12">
        <!-- CONTAINER CASES DASHBOARD -->
        <div class="row m-0 p-0">
            <!-- a -->
            <!-- CASE DASHBOARD -->
            <div class="col-12 col-md-6 my-1 mx-0">
                <div class="bgIsWhitePage row m-0 p-2 border-bottom smallStrongShadowDown border rounded noscrollbar">
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <i class="fa-solid fa-boxes-stacked" aria-hidden="true"></i>
                                    <span class="sectionName text-dark">
                                        Stocks
                                    </span>
                                    -
                                    <span class="subsectionName text-secondary">
                                        Réapprovisionnement
                                    </span>
                                </h5>
                            </div>
                            <button class="col-auto m-0 px-2 py-1 mb-1 btn btn-light text-primary"
                                onclick='ERPMODALS.openPage("Stocks - Réapprovisionnements","erp_stocks_reappro_gerant.html");'>
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped overflow-y-scroll" id="restock-table">
                            <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Montant</th>
                                    <th scope="col">État</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- CASE DASHBOARD -->
            <div class="col-12 col-md-6 my-1 mx-0">
                <div class="bgIsWhitePage row m-0 p-2 border-bottom smallStrongShadowDown border rounded noscrollbar">
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <i class="fa-solid fa-file-invoice-dollar"></i>
                                    <span class="sectionName text-dark">
                                        Comptabilité
                                    </span>
                                    -
                                    <span class="subsectionName text-secondary">
                                        Validation
                                    </span>
                                </h5>
                            </div>
                            <button class="col-auto m-0 px-2 py-1 mb-1 btn btn-light text-primary"
                                onclick='ERPMODALS.openPage("Comptabilité - Validation","erp_comptabilite_validation.html");'>
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped overflow-y-scroll">
                            <thead>
                                <tr>
                                    <th scope="col">N°</th>
                                    <th scope="col">Montant</th>
                                    <th scope="col">Date</th>
                                    <th scope="col">Validation</th>
                                </tr>
                            </thead>
                            <tbody id="table-transac">
                                <!-- rows -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <!-- CASE DASHBOARD -->
            <div class="col-12 col-md-6 my-1 mx-0">
                <div class="bgIsWhitePage row m-0 p-2 border-bottom smallStrongShadowDown border rounded noscrollbar">
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <i class="fa-regular fa-envelope" aria-hidden="true"></i>
                                    <span class="sectionName text-dark">
                                        Communication
                                    </span>
                                </h5>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <span class="sectionName text-dark">
                                        Interne
                                    </span>
                                    -
                                    <span class="subsectionName text-secondary">
                                        Comptes PGI
                                    </span>
                                </h5>
                            </div>
                            <button type="button" class="btn btn-link"
                                onclick='ERPMODALS.openPage("Communication - Interne","erp_administration_comptes.html");'>
                                Gérer et communiquer
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </button>
                            <button type="button" class="btn btn-link" onclick="ERPMODALS.open.valider_compte();">
                                Valider de nouveaux comptes
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <span class="sectionName text-dark">
                                        Externe
                                    </span>
                                    -
                                    <span class="subsectionName text-secondary">
                                        Direction régionale
                                    </span>
                                </h5>
                            </div>
                            <div class="d-grid gap-2 d-md-block">
                                <button type="button" class="btn btn-link"
                                    onclick='ERPMODALS.openPage("Communication - Externe","erp_administration_directionregionale.html");'>
                                    Réceptionner et diffuser
                                    <i class="fa-solid fa-arrow-up-right-from-square"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- CASE DASHBOARD -->
            <div class="col-12 col-md-6 my-1 mx-0">
                <div class="bgIsWhitePage row m-0 p-2 border-bottom smallStrongShadowDown border rounded noscrollbar">
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <i class="fa-regular fa-flag" aria-hidden="true"></i>
                                    <span class="sectionName text-dark">
                                        Incidents
                                    </span>
                                    -
                                    <span class="subsectionName text-secondary">
                                        Validations
                                    </span>
                                </h5>
                            </div>
                            <button class="col-auto m-0 px-2 py-1 mb-1 btn btn-light text-primary"
                                onclick='ERPMODALS.openPage("Incidents - Registre courant","erp_incidents_registre_employe.html");'>
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped overflow-y-scroll">
                            <thead>
                                <tr>
                                    <th scope="col">N°</th>
                                    <th scope="col">Incident</th>
                                    <th scope="col">Date</th>
                                    <th scope="col">Validation</th>
                                </tr>
                            </thead>
                            <tbody id="table-incident"></tbody>
                        </table>
                    </div>
                    <button type="submit" id="openModalIncident" class="btn btn-primary btn-sm"
                        onclick="ERPMODALS.open.creer_incident();">
                        Nouvel incident
                    </button>
                </div>
            </div>
            <!-- CASE DASHBOARD -->
            <div class="col-12 col-md-6 my-1 mx-0">
                <div class="bgIsWhitePage row m-0 p-2 border-bottom smallStrongShadowDown border rounded noscrollbar">
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <i class="fa-solid fa-file-invoice-dollar"></i>
                                    <span class="sectionName text-dark">
                                        Formations
                                    </span>
                                </h5>
                            </div>
                            <button class="col-auto m-0 px-2 py-1 mb-1 btn btn-light text-primary"
                                onclick='ERPMODALS.openPage("Client - Formations","erp_formations.html");'>
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped overflow-y-scroll" id="formations-table">
                            <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Mail</th>
                                    <th scope="col">Type</th>
                                    <th scope="col">Début</th>
                                    <th scope="col">Fin</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <button type="button" class="btn btn-primary btn-sm"
                        onclick="if(isGerant){ERPMODALS.open.ajouter_formation()}else{alert('Vous n\'avez pas les droits suffisants !');}">Nouvelle
                        formation</button>
                </div>
            </div>
            <!-- a -->
            <!-- CASE DASHBOARD -->
            <div class="col-12 col-md-6 my-1 mx-0">
                <div class="bgIsWhitePage row m-0 p-2 border-bottom smallStrongShadowDown border rounded noscrollbar">
                    <div class="col-12 px-3 py-1">
                        <div class="row d-flex justify-content-between align-items-center border-bottom">
                            <div class="col-auto p-0 m-0">
                                <h5>
                                    <i class="fa-solid fa-users" aria-hidden="true"></i>
                                    <span class="sectionName text-dark">
                                        Client
                                    </span>
                                    -
                                    <span class="subsectionName text-secondary">
                                        Membres
                                    </span>
                                </h5>
                            </div>
                            <button class="col-auto m-0 px-2 py-1 mb-1 btn btn-light text-primary"
                                onclick='ERPMODALS.openPage("Client - Membres","erp_clients_membres.html");'>
                                <i class="fa-solid fa-arrow-up-right-from-square"></i>
                            </button>
                        </div>
                    </div>
                    <!-- A -->
                    <div id="Member_Container" class="p-1 col-12 py-5 flexiCenter">
                        <div class=" ">
                            <div id="MemberSearch" class="dropdown-center">
                                <button
                                    class="btn btn-white border border-warning dropdown-toggle pt-2 position-relative"
                                    type="button" data-bs-toggle="dropdown" aria-expanded="false"
                                    onclick="actualiserMembres();">
                                    Chercher un membre
                                    <div class="btn btn-sm btn-warning text-white my-1 py-0 px-2 col-auto position-absolute top-0 end-0 translate-middle-y"
                                        onclick="ERPMODALS.open.creer_membre()">
                                        Nouveau <i class="fa-regular text-white fa-square-plus" aria-hidden="true"></i>
                                    </div>
                                </button>
                                <ul class="dropdown-menu" id="MemberSearchDropdownMenu"></ul>
                            </div>
                            <div id="MemberTable"
                                class="position-relative rounded border border-warning p-2 smallStrongShadowRight">
                                <table class="p-2" style="border-spacing: 3px !important;" class="">
                                    <tbody>
                                        <tr>
                                            <td class="fw-bold memberdisplayName">
                                                Alexis
                                            </td>
                                            <td class="fw-bold pe-2 border-end memberdisplaySurname">
                                                Legros
                                            </td>
                                            <td rowspan="2"
                                                class="ps-2 pe-1 justify-content-center align-items-center d-table-cell">
                                                <div
                                                    class="position-relative border-success border-2 align-items-center border-bottom rounded">
                                                    &nbsp;<span class="memberdisplayCredits">11,24</span>&nbsp;€&nbsp;
                                                    <span
                                                        class="position-absolute top-0 start-0 translate-middle-y badge p-0 m-0 text-success">
                                                        Crédits
                                                    </span>
                                                </div>
                                            </td>
                                            <td rowspan="2"
                                                class="px-1 justify-content-center align-items-center d-table-cell">
                                                <div
                                                    class="position-relative border-primary border-2 align-items-center border-bottom rounded">
                                                    &nbsp;<span class="memberdisplayPoints">1124</span>&nbsp;
                                                    <span
                                                        class="position-absolute top-0 start-0 translate-middle-y badge p-0 m-0 text-primary">
                                                        Points
                                                    </span>
                                                </div>
                                            </td>
                                            <td rowspan="2" class="ps-1 justify-content-center align-items-center">
                                                <button id="btnRemoveMember" type="button"
                                                    class="btn btn-close btn-dark"></button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2" class="pe-2 border-end memberdisplayEmail">
                                                alexislegrosnc@gmail.com
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="d-none memberdisplayId">1</div>
                                <div class="btn btn-sm btn-secondary text-white my-1 py-0 px-2 col-auto position-absolute top-0 end-0 translate-middle-y"
                                    onclick="ERPMODALS.open.modifier_membre(this.parentNode.querySelector('.memberdisplayId').innerText)">
                                    Modifier <i class="fa-solid fa-pen-to-square"></i>
                                </div>
                            </div>
                            <script>
                                let memberSection = {
                                    container: document.getElementById("Member_Container"),
                                    memberDisplay: document.getElementById("MemberTable"),
                                    removeMemberBtn: document.getElementById("btnRemoveMember"),
                                    searchDisplay: document.getElementById("MemberSearch"),
                                    member: {
                                        id: undefined,
                                        name: undefined,
                                        surname: undefined,
                                        email: undefined,
                                        credit: undefined,
                                        points: undefined,
                                    },
                                    clear: function () {
                                        this.set(undefined, undefined, undefined, undefined, undefined, undefined);
                                    },
                                    set: function (argId, argName, argSurname, argEmail, argCredit, argPoints, argDisplay) {
                                        this.member.id = argId;
                                        this.member.name = argName;
                                        this.member.surname = argSurname;
                                        this.member.email = argEmail;
                                        this.member.credit = argCredit;
                                        this.member.points = argPoints;
                                        if (argDisplay) {
                                            this.displayMember();
                                        }
                                    },
                                    displayMember: function () {
                                        if (false) {
                                            this.displaySearch();
                                            return;
                                        }
                                        elementsToEdit = this.memberDisplay.getElementsByClassName("memberdisplayId");
                                        for (let i = 0; i < elementsToEdit.length; i++) {
                                            elementsToEdit[i].innerHTML = this.member.id;
                                        }
                                        elementsToEdit = this.memberDisplay.getElementsByClassName("memberdisplayName");
                                        for (let i = 0; i < elementsToEdit.length; i++) {
                                            elementsToEdit[i].innerHTML = this.member.name;
                                        }
                                        elementsToEdit = this.memberDisplay.getElementsByClassName("memberdisplaySurname");
                                        for (let i = 0; i < elementsToEdit.length; i++) {
                                            elementsToEdit[i].innerHTML = this.member.surname;
                                        }
                                        elementsToEdit = this.memberDisplay.getElementsByClassName("memberdisplayEmail");
                                        for (let i = 0; i < elementsToEdit.length; i++) {
                                            elementsToEdit[i].innerHTML = this.member.email;
                                        }
                                        elementsToEdit = this.memberDisplay.getElementsByClassName("memberdisplayCredits");
                                        for (let i = 0; i < elementsToEdit.length; i++) {
                                            elementsToEdit[i].innerHTML = this.member.credit;
                                        }
                                        elementsToEdit = this.memberDisplay.getElementsByClassName("memberdisplayPoints");
                                        for (let i = 0; i < elementsToEdit.length; i++) {
                                            elementsToEdit[i].innerHTML = this.member.points;
                                        }
                                        this.searchDisplay.style.display = "none";
                                        this.memberDisplay.style.display = "block";
                                    },
                                    displaySearch: function () {
                                        this.searchDisplay.style.display = "block";
                                        this.memberDisplay.style.display = "none";
                                    },
                                    checkField: function (arg) {
                                        return arg != null && arg != undefined && arg != NaN;
                                    },
                                    checkAll: function () {
                                        return (
                                            this.checkField(this.member.name) && this.checkField(this.member.surname) && this.checkField(this.member.email) && this.checkField(this.member.credit) && this.checkField(this.member.points)
                                        );
                                    },
                                    setEventListeners: function () {
                                        let self = this;
                                        this.removeMemberBtn.addEventListener("click", function () {
                                            self.clear();
                                            self.displaySearch();
                                        });
                                    },
                                };
                                memberSection.setEventListeners();
                                memberSection.clear();
                                memberSection.displaySearch();
                            </script>
                        </div>
                    </div>
                    <!-- A -->
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    function fetchRestocks() {
        const tbody = document.querySelector("#restock-table tbody");
        tbody.innerHTML = "";
        fetch(URL_SERVER_NAME + "/api/restock/all")
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Failed to fetch restock data");
                }
                return response.json();
            })
            .then((data) => {
                data.forEach((restock) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                  <th scope="row">${restock.restockId}</th>
                  <td>${restock.amount}</td>
                  <td>
                      <span class="badge text-bg-success">${restock.status}</span><br />
                      <span class="badge badge-sm bg-white text-black rounded px-1 border border-1 border-black">${restock.date.replace("T", " ")}</span>
                  </td>
              `;
                    tbody.appendChild(row);
                });
            })
            .catch((error) => {
                console.error("Error fetching restock data:", error);
            });
    }

    fetchRestocks();
</script>
<script>
    function fetchFormations() {
        const tbody = document.querySelector("#formations-table tbody");
        tbody.innerHTML = "";
        fetch(URL_SERVER_NAME + "/api/course/all")
            .then((response) => {
                if (!response.ok) {
                    throw new Error("Failed to fetch course data");
                }
                return response.json();
            })
            .then((data) => {
                data.forEach((course) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                      <th scope="row">${course.courseId}</th>
                      <td>${course.mail}</td>
                      <td>${course.type || "Inconnu"}</td>
                      <td>${course.startDate}</td>
                      <td>${course.endDate}</td>
                  `;
                    tbody.appendChild(row);
                });
            })
            .catch((error) => {
                console.error("Error fetching course data:", error);
            });
    }

    fetchFormations();
</script>

<script>
    console.log("Fetching transactions from the API...");
    const request = new XMLHttpRequest();
    request.open("GET", URL_SERVER_NAME + "/api/crt/all", true);
    request.onload = function () {
        if (request.status >= 200 && request.status < 400) {
            const data = JSON.parse(request.responseText);
            console.log(data);
            const sortedData = data.sort((a, b) => {
                // tri par statut validé
                if (a.validated !== b.validated) {
                    return a.validated ? 1 : -1; // d'abord les transactions validées
                }
                // si les deux sont validées ou non validées, on trie par ordre décroissant de transactionId
                return b.transactionId - a.transactionId;
            });
            populateTable(sortedData);
        } else {
            console.error("Failed to fetch data from the API.");
        }
    };

    request.onerror = function () {
        console.error("There was a network error.");
    };

    request.send();

    function populateTable(data) {
        const tableBody = document.getElementById("table-transac");
        tableBody.innerHTML = "";

        data.forEach((transaction) => {
            const row = document.createElement("tr");

            row.innerHTML = `
              <th scope="row">${transaction.transactionId}</th>
              <td>${transaction.amount}€</td>
              <td>${transaction.date.replace("T", " ")}</td>`;

            const buttonCell = document.createElement("td");
            if (transaction.validated) {
                row.classList.add("border-start", "border-2", "rounded", "border-success");
            } else {
                const button = document.createElement("button");
                button.className = "btn btn-success btn-sm";
                button.innerHTML = '<i class="fa-solid fa-check btn-sm"></i>';
                button.addEventListener("click", function () {
                    fetch(URL_SERVER_NAME + "/api/crt/validate", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: transaction.transactionId,
                    })
                        .then((response) => {
                            console.log(response);
                            //on supprime le bouton
                            buttonCell.innerHTML = "";
                            //on change la couleur de la ligne
                            row.classList.add("border-start", "border-2", "rounded", "border-success");
                        })
                        .catch((error) => {
                            console.error("Error:", error);
                        });
                });
                buttonCell.appendChild(button);
            }
            row.appendChild(buttonCell);
            tableBody.appendChild(row);
        });
    }

    console.log("Fetching incidents from the API...");
    const requestIncidents = new XMLHttpRequest();
    requestIncidents.open("GET", URL_SERVER_NAME + "/api/incident/all", true);
    requestIncidents.onload = function () {
        if (requestIncidents.status >= 200 && requestIncidents.status < 400) {
            const data = JSON.parse(requestIncidents.responseText);
            console.log(data);
            const sortedData = data.sort((a, b) => {
                // tri par statut fermé
                if (a.closed !== b.closed) {
                    return a.closed ? 1 : -1; // d'abord les incidents fermés
                }
                // si les deux sont fermés ou ouverts, on trie par ordre décroissant de incidentId
                return b.incidentId - a.incidentId;
            });
            populateTableIncidents(sortedData);
        } else {
            console.error("Failed to fetch data from the API.");
        }
    };

    requestIncidents.onerror = function () {
        console.error("There was a network error.");
    };

    requestIncidents.send();

    function populateTableIncidents(data) {
        const tableBody = document.getElementById("table-incident");
        tableBody.innerHTML = "";

        data.forEach((incident) => {
            const row = document.createElement("tr");

            row.innerHTML = `
              <th scope="row">${incident.incidentId}</th>
              <td>${incident.description}</td>
              <td>${incident.date.replace("T", " ")}</td>`;

            const buttonCell = document.createElement("td");
            if (incident.closed) {
                row.classList.add("border-start", "border-2", "rounded", "border-success");
            } else {
                const buttonCell = document.createElement("td");
                const button = document.createElement("button");
                button.className = "btn btn-success btn-sm";
                button.innerHTML = '<i class="fa-solid fa-check btn-sm"></i>';
                button.addEventListener("click", function () {
                    fetch(URL_SERVER_NAME + "/api/incident/updateStatus", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            idIncident: incident.incidentId,
                            closed: true,
                        }),
                    })
                        .then((response) => {
                            console.log(response);
                            //on supprime le bouton
                            buttonCell.innerHTML = "";
                            //on change la couleur de la ligne
                            row.classList.add("border-start", "border-2", "rounded", "border-success");
                        })
                        .catch((error) => {
                            console.error("Error:", error);
                        });
                });
                buttonCell.appendChild(button);
                row.appendChild(buttonCell);
            }
            row.appendChild(buttonCell);
            tableBody.appendChild(row);
        });
    }
</script>
<script>
    console.log("Fetching members from the API...");
    let requestMembersCashRegister = new XMLHttpRequest();
    let memberDatas;
    requestMembersCashRegister.open("GET", URL_SERVER_NAME + "/api/customer/all", true);
    requestMembersCashRegister.onload = function () {
        fetchMembers();
    };

    function fetchMembers() {
        if (requestMembersCashRegister.status >= 200 && requestMembersCashRegister.status < 400) {
            console.log("Members fetched successfully.");
            memberDatas = JSON.parse(requestMembersCashRegister.responseText);
            populateDropdownMenu(memberDatas);
        } else {
            console.error("Failed to fetch data from the API.");
        }
    }

    requestMembersCashRegister.onerror = function () {
        console.error("There was a network error.");
    };

    requestMembersCashRegister.send();

    function populateDropdownMenu(data) {
        const dropdownMenu = document.getElementById("MemberSearchDropdownMenu");
        dropdownMenu.innerHTML = '<input type="text" class="form-control" placeholder="Doe John" onkeyup="filterTheZone(this.parentNode,this.value)"/>';

        data.forEach((member) => {
            const fullName = `${member.firstName} ${member.lastName}`;
            const listItem = document.createElement("li");
            listItem.setAttribute("filterstring", " " + member.customerId + " " + member.firstName + " " + member.lastName + " " + member.mail + " " + member.points + " " + member.points);
            listItem.classList.add("dropdown-item", "filteredElement");
            listItem.textContent = fullName;
            listItem.addEventListener("click", function () {
                memberSection.set(member.customerId, member.firstName, member.lastName, member.mail, member.points, member.points, true);
            });
            dropdownMenu.appendChild(listItem);
        });
    }

    document.getElementById("openDropdownButton").addEventListener("click", function () {
        actualiserMembres();
    });

    function actualiserMembres() {
        requestMembersCashRegister = new XMLHttpRequest();
        requestMembersCashRegister.open("GET", URL_SERVER_NAME + "/api/customer/all", true);
        requestMembersCashRegister.onload = function () {
            fetchMembers();
        };
        requestMembersCashRegister.onerror = function () {
            console.error("There was a network error.");
        };
        fetchMembers();
        requestMembersCashRegister.send();
    }
</script>

<script>

    const notifyUnderLimit = (data) => {
        data.forEach((product) => {
            if (product.quantity < product.limit) {
                //alerte bootstrap
                    const alert = document.createElement("div");
                    alert.classList.add("alert", "alert-warning", "alert-dismissible", "fade", "show");
                    alert.setAttribute("role", "alert");
                    alert.innerHTML = `
                        <strong>Attention !</strong> Le produit ${product.name} n'a que ${product.quantity} de stock. C'est moins que sa limite (${product.limit}).
                        <button type="button" class="btn-close" data-dismiss="alert" aria-label="Close" id="closeAlert-${product.productId}">
                        </button>
                    `;
                    //ajouter un event listener pour fermer l'alerte
                    alert.querySelector(`#closeAlert-${product.productId}`).addEventListener("click", () => {
                        alert.remove();
                    });
                    //ajouter en haut de la page pour que ce soit visible
                    document.querySelector(".container-fluid").prepend(alert);
                    console.log(`Le produit ${product.name} est en dessous de la limite de stock. Lancez une commande !`);
            }
        });
    };

    fetch(URL_SERVER_NAME + "/api/energy/all")
        .then((response) => {
            if (!response.ok) {
                throw new Error("Failed to fetch product data");
            }
            return response.json();
        })
        .then((data) => {
            console.log(data);
            notifyUnderLimit(data);
        })
        .catch((error) => {
            console.error("Error fetching product data:", error);
        });
</script>

</html>